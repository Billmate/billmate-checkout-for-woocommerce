!function(e){var o={};function t(i){if(o[i])return o[i].exports;var a=o[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,t),a.l=!0,a.exports}t.m=e,t.c=o,t.d=function(e,o,i){t.o(e,o)||Object.defineProperty(e,o,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,o){if(1&o&&(e=t(e)),8&o)return e;if(4&o&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&o&&"string"!=typeof e)for(var a in e)t.d(i,a,function(o){return e[o]}.bind(null,a));return i},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},t.p="",t(t.s=0)}([function(e,o){jQuery((function(e){const o={update:function(){checkout_iframe.postMessage("update","*")},lock:function(){checkout_iframe.postMessage("lock","*")},unlock:function(){checkout_iframe.postMessage("unlock","*")},purchase_complete:function(){checkout_iframe.postMessage("purchase_complete","*")},hide_overlay:function(){e("#bco-wrapper").removeClass("processing").unblock()},handleEvent:function(t){if(""!=t.origin){try{var i=JSON.parse(t.data)}catch(e){return}switch(i.event){case"purchase_initialized":o.logToFile("purchase_initialized from Billmate triggered"),o.getBillmateCheckout(),e("body").on("bco_order_validation",(function(e,t){!0===t&&o.purchase_complete()}));break;case"address_selected":if("checkout"!==bco_wc_params.checkout_flow)return;var a="",r="";if("object"==typeof i.data.Customer.Shipping&&"zip"in i.data.Customer.Shipping&&""!==i.data.Customer.Shipping.zip){if(a=i.data.Customer.Shipping.zip,r=i.data.Customer.Shipping.country,o.addressData.shippingAddress=i.data.Customer.Shipping,billingAddress=o.setBillingAddress(i.data),o.addressData.shippingZip===a)return;o.addressData.updateNeeded="yes"}else{if(billingAddress=o.setBillingAddress(i.data),a=i.data.Customer.Billing.zip,r=i.data.Customer.Billing.country,o.addressData.billingZip===billingAddress.billingZip)return;o.addressData.updateNeeded="yes"}o.addressData.billingZip=billingAddress.billingZip,o.addressData.billingCountry=billingAddress.billingCountry,o.addressData.shippingZip=a,o.addressData.shippingCountry=r,e("#jsLog").append("address_selected<br />"),"yes"===o.addressData.updateNeeded&&(e(".woocommerce-checkout-review-order-table").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajax({url:bco_wc_params.iframe_shipping_address_change_url,type:"POST",dataType:"json",data:{address:o.addressData,nonce:bco_wc_params.iframe_shipping_address_change_nonce},success:function(t){o.setCustomerData(t.data),e("body").trigger("update_checkout")},error:function(e){},complete:function(){o.shippingUpdated=!0,e(".woocommerce-checkout-review-order-table").unblock()}}));break;case"payment_method_selected":e("#jsLog").append("payment_method_selected<br />");break;case"checkout_success":if(e("#jsLog").append("checkout_success<br />"),"checkout"===bco_wc_params.checkout_flow){var n=sessionStorage.getItem("billmateRedirectUrl");n&&(window.location.href=n)}else e.ajax({url:bco_wc_params.checkout_success_url,type:"POST",dataType:"json",data:{nonce:bco_wc_params.checkout_success_nonce},success:function(){},error:function(){},complete:function(e){window.location.href=e.responseJSON.data.bco_wc_received_url}});break;case"content_height":e(document).find("#checkout").height(i.data),e("#jsLog").append("content_height: "+i.data+"<br />");break;case"content_scroll_position":window.latestScroll=e(document).find("#checkout").offset().top+i.data,e("html, body").animate({scrollTop:e(document).find("#checkout").offset().top+i.data},400),e("#jsLog").append("content_scroll_position: "+i.data+"<br />");break;case"checkout_loaded":e("#jsLog").append("checkout_loaded<br />");break;case"hide_overlay":o.hide_overlay()}}},bodyEl:e("body"),checkoutFormSelector:"form.checkout",shippingUpdated:!1,orderNotesValue:"",orderNotesSelector:"textarea#order_comments",orderNotesEl:e("textarea#order_comments"),paymentMethodEl:e('input[name="payment_method"]'),paymentMethod:"",selectAnotherSelector:"#billmate-checkout-select-other",addressData:{billingAddress:[],billingZip:"",billingCountry:"",shippingAddress:[],shippingZip:"",shippingCountry:"",updateNeeded:"no"},blocked:!1,extraFieldsSelectorText:'div#bco-extra-checkout-fields input[type="text"], div#bco-extra-checkout-fields input[type="password"], div#bco-extra-checkout-fields textarea, div#bco-extra-checkout-fields input[type="email"], div#bco-extra-checkout-fields input[type="tel"]',extraFieldsSelectorNonText:'div#bco-extra-checkout-fields select, div#bco-extra-checkout-fields input[type="radio"], div#bco-extra-checkout-fields input[type="checkbox"], div#bco-extra-checkout-fields input.checkout-date-picker, input#terms input[type="checkbox"]',setBillingAddress:function(e){var t="",i="";return"object"==typeof e.billingAddress&&"zip"in e.billingAddress&&""!==e.billingAddress.zip?(t=e.billingAddress.zip,i=e.billingAddress.country,o.addressData.billingAddress=e.billingAddress):"object"==typeof e.Customer.Billing&&"zip"in e.Customer.Billing&&""!==e.Customer.Billing.zip&&(t=e.Customer.Billing.zip,i=e.Customer.Billing.country,o.addressData.billingAddress=e.Customer.Billing),{billingZip:t,billingCountry:i}},updateBillmateCheckout:function(){e(".woocommerce-checkout-review-order-table").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajax({type:"POST",url:bco_wc_params.update_checkout_url,data:{nonce:bco_wc_params.update_checkout_nonce},dataType:"json",success:function(e){},error:function(e){},complete:function(t){!0===t.responseJSON.success?(t.responseJSON.data&&t.responseJSON.data.refreshZeroAmount&&window.location.reload(),o.update(),e(".woocommerce-checkout-review-order-table").unblock()):""!==t.responseJSON.data.redirect_url&&(window.location.href=t.responseJSON.data.redirect_url)}})},getBillmateCheckout:function(){e.ajax({type:"POST",url:bco_wc_params.get_checkout_url,data:{nonce:bco_wc_params.get_checkout_nonce},dataType:"json",success:function(e){},error:function(e){return!1},complete:function(t){o.setCustomerData(t.responseJSON.data),e("form.checkout #terms").length>0&&e("form.checkout #terms").prop("checked",!0),o.submitForm()}})},setCustomerData:function(o){null!==o.billing_address&&void 0!==o.billing_address?(e("#billing_first_name").val("firstname"in o.billing_address?o.billing_address.firstname:""),e("#billing_last_name").val("lastname"in o.billing_address?o.billing_address.lastname:""),e("#billing_company").val("company"in o.billing_address?o.billing_address.company:""),e("#billing_address_1").val("street"in o.billing_address?o.billing_address.street:""),e("#billing_address_2").val("street2"in o.billing_address?o.billing_address.street2:""),e("#billing_city").val("city"in o.billing_address?o.billing_address.city:""),e("#billing_postcode").val("zip"in o.billing_address?o.billing_address.zip:""),e("#billing_phone").val("phone"in o.billing_address?o.billing_address.phone:""),e("#billing_email").val("email"in o.billing_address?o.billing_address.email:""),e("#billing_country").val("country"in o.billing_address?o.billing_address.country.toUpperCase():"")):window.location.reload(),null!==o.shipping_address?(e("#ship-to-different-address-checkbox").prop("checked",!0),e("#shipping_first_name").val("firstname"in o.shipping_address?o.shipping_address.firstname:""),e("#shipping_last_name").val("lastname"in o.shipping_address?o.shipping_address.lastname:""),e("#shipping_company").val("company"in o.shipping_address?o.billing_address.company:""),e("#shipping_address_1").val("street"in o.shipping_address?o.shipping_address.street:""),e("#shipping_address_2").val("street2"in o.shipping_address?o.shipping_address.street2:""),e("#shipping_city").val("city"in o.shipping_address?o.shipping_address.city:""),e("#shipping_postcode").val("zip"in o.shipping_address?o.shipping_address.zip:""),e("#shipping_country").val("country"in o.shipping_address?o.shipping_address.country.toUpperCase():"")):(e("#shipping_first_name").val("firstname"in o.billing_address?o.billing_address.firstname:""),e("#shipping_last_name").val("lastname"in o.billing_address?o.billing_address.lastname:""),e("#shipping_company").val("company"in o.billing_address?o.billing_address.company:""),e("#shipping_address_1").val("street"in o.billing_address?o.billing_address.street:""),e("#shipping_address_2").val("street2"in o.billing_address?o.billing_address.street2:""),e("#shipping_city").val("city"in o.billing_address?o.billing_address.city:""),e("#shipping_postcode").val("zip"in o.billing_address?o.billing_address.zip:""),e("#shipping_country").val("country"in o.billing_address?o.billing_address.country.toUpperCase():""))},documentReady:function(){o.moveExtraCheckoutFields(),"checkout"===bco_wc_params.checkout_flow&&"two_column_checkout"===bco_wc_params.checkout_layout&&(e("form.checkout.woocommerce-checkout").addClass("bco-two-column-checkout-left"),e("#bco-iframe").addClass("bco-two-column-checkout-right"))},changeFromBCO:function(t){t.preventDefault(),e(o.checkoutFormSelector).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajax({type:"POST",dataType:"json",data:{bco:!1,nonce:bco_wc_params.change_payment_method_nonce},url:bco_wc_params.change_payment_method_url,success:function(e){},error:function(e){},complete:function(e){window.location.href=e.responseJSON.data.redirect}})},maybeChangeToBCO:function(){"bco"===e(this).val()&&(e(o.checkoutFormSelector).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e(".woocommerce-info").remove(),e.ajax({type:"POST",data:{bco:!0,nonce:bco_wc_params.change_payment_method_nonce},dataType:"json",url:bco_wc_params.change_payment_method_url,success:function(e){},error:function(e){},complete:function(e){window.location.href=e.responseJSON.data.redirect}}))},moveExtraCheckoutFields:function(){e(".woocommerce-additional-fields").appendTo("#bco-extra-checkout-fields");var o=e('form[name="checkout"] input, form[name="checkout"] select, textarea');for(i=0;i<o.length;i++){var t=o[i].name;-1===e.inArray(t,bco_wc_params.standard_woo_checkout_fields)&&(0<e("p#"+t+"_field").length?e("p#"+t+"_field").appendTo("#bco-extra-checkout-fields"):e('input[name="'+t+'"]').closest("p").appendTo("#bco-extra-checkout-fields"))}},checkIfSelected:function(){return o.paymentMethodEl.length>0&&(o.paymentMethod=o.paymentMethodEl.filter(":checked").val(),"bco"===o.paymentMethod)},submitForm:function(){e(".woocommerce-checkout-review-order-table").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajax({type:"POST",url:bco_wc_params.submit_order,data:e("form.checkout").serialize(),dataType:"json",success:function(t){try{if("success"!==t.result)throw"Result failed";o.logToFile("Successfully placed order. Sending bco_order_validation true to Billmate"),e("body").trigger("bco_order_validation",!0),sessionStorage.setItem("billmateRedirectUrl",t.redirect_url),e("form.checkout").removeClass("processing").unblock()}catch(e){t.messages?(o.logToFile("Checkout error | "+t.messages),o.failOrder("submission",t.messages)):(o.logToFile("Checkout error | No message"),o.failOrder("submission",'<div class="woocommerce-error">Checkout error</div>'))}},error:function(e){o.logToFile("AJAX error | "+e),o.failOrder("ajax-error",e)}})},failOrder:function(t,i){e("body").trigger("bco_order_validation",!1),e("body").trigger("updated_checkout"),e(o.checkoutFormSelector).unblock(),e(".woocommerce-checkout-review-order-table").unblock(),e(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),e("form.checkout").prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+i+"</div>"),e("form.checkout").removeClass("processing").unblock(),e("form.checkout").find(".input-text, select, input:checkbox").trigger("validate").blur(),e(document.body).trigger("checkout_error",[i]),e("html, body").animate({scrollTop:e("form.checkout").offset().top-100},1e3)},logToFile:function(o){e.ajax({url:bco_wc_params.log_to_file_url,type:"POST",dataType:"json",data:{message:o,nonce:bco_wc_params.log_to_file_nonce}})},init:function(){window.addEventListener("message",o.handleEvent),o.checkIfSelected()&&(e(document).ready(o.documentReady()),o.bodyEl.on("click",o.selectAnotherSelector,o.changeFromBCO),"checkout"===bco_wc_params.checkout_flow&&o.bodyEl.on("updated_checkout",o.updateBillmateCheckout)),o.bodyEl.on("change",'input[name="payment_method"]',o.maybeChangeToBCO),o.bodyEl.on("click",o.selectAnotherSelector,o.changeFromBCO)}};o.init()}))}]);
//# sourceMappingURL=bco-checkout.min.js.map