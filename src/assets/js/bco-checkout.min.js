!function(e){var t={};function o(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=e,o.c=t,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(i,a,function(t){return e[t]}.bind(null,a));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t){jQuery((function(e){const t={update:function(){checkout_iframe.postMessage("update","*")},lock:function(){checkout_iframe.postMessage("lock","*")},unlock:function(){checkout_iframe.postMessage("unlock","*")},purchase_complete:function(){checkout_iframe.postMessage("purchase_complete","*")},hide_overlay:function(){e("#bco-wrapper").removeClass("processing").unblock()},handleEvent:function(o){if(""!=o.origin){try{var i=JSON.parse(o.data)}catch(e){return}switch(i.event){case"purchase_initialized":t.logToFile("purchase_initialized from Billmate triggered"),t.getBillmateCheckout(),e("body").on("bco_order_validation",(function(e,o){!0===o&&t.purchase_complete()}));break;case"address_selected":if("checkout"!==bco_wc_params.checkout_flow)return;var a="",r="";if("object"==typeof i.data.Customer.Shipping&&"zip"in i.data.Customer.Shipping&&""!==i.data.Customer.Shipping.zip){if(a=i.data.Customer.Shipping.zip,r=i.data.Customer.Shipping.country,t.addressData.shippingAddress=i.data.Customer.Shipping,billingAddress=t.setBillingAddress(i.data),t.addressData.shippingZip===a)return;t.addressData.updateNeeded="yes"}else{if(billingAddress=t.setBillingAddress(i.data),a=i.data.Customer.Billing.zip,r=i.data.Customer.Billing.country,t.addressData.billingZip===billingAddress.billingZip)return;t.addressData.updateNeeded="yes"}t.addressData.billingZip=billingAddress.billingZip,t.addressData.billingCountry=billingAddress.billingCountry,t.addressData.shippingZip=a,t.addressData.shippingCountry=r,e("#jsLog").append("address_selected<br />"),"yes"===t.addressData.updateNeeded&&(e(".woocommerce-checkout-review-order-table").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajax({url:bco_wc_params.iframe_shipping_address_change_url,type:"POST",dataType:"json",data:{address:t.addressData,nonce:bco_wc_params.iframe_shipping_address_change_nonce},success:function(o){t.setCustomerData(o.data),e("body").trigger("update_checkout")},error:function(e){},complete:function(){t.shippingUpdated=!0,e(".woocommerce-checkout-review-order-table").unblock()}}));break;case"payment_method_selected":e("#jsLog").append("payment_method_selected<br />");break;case"checkout_success":if(e("#jsLog").append("checkout_success<br />"),"checkout"===bco_wc_params.checkout_flow){var n=sessionStorage.getItem("billmateRedirectUrl");n&&(window.location.href=n)}else e.ajax({url:bco_wc_params.checkout_success_url,type:"POST",dataType:"json",data:{nonce:bco_wc_params.checkout_success_nonce},success:function(){},error:function(){},complete:function(e){window.location.href=e.responseJSON.data.bco_wc_received_url}});break;case"content_height":e(document).find("#checkout").height(i.data),e("#jsLog").append("content_height: "+i.data+"<br />");break;case"content_scroll_position":window.latestScroll=e(document).find("#checkout").offset().top+i.data,e("html, body").animate({scrollTop:e(document).find("#checkout").offset().top+i.data},400),e("#jsLog").append("content_scroll_position: "+i.data+"<br />");break;case"checkout_loaded":e("#jsLog").append("checkout_loaded<br />");break;case"hide_overlay":t.hide_overlay()}}},bodyEl:e("body"),checkoutFormSelector:"form.checkout",shippingUpdated:!1,orderNotesValue:"",orderNotesSelector:"textarea#order_comments",orderNotesEl:e("textarea#order_comments"),paymentMethodEl:e('input[name="payment_method"]'),paymentMethod:"",selectAnotherSelector:"#billmate-checkout-select-other",addressData:{billingAddress:[],billingZip:"",billingCountry:"",shippingAddress:[],shippingZip:"",shippingCountry:"",updateNeeded:"no"},blocked:!1,extraFieldsSelectorText:'div#bco-extra-checkout-fields input[type="text"], div#bco-extra-checkout-fields input[type="password"], div#bco-extra-checkout-fields textarea, div#bco-extra-checkout-fields input[type="email"], div#bco-extra-checkout-fields input[type="tel"]',extraFieldsSelectorNonText:'div#bco-extra-checkout-fields select, div#bco-extra-checkout-fields input[type="radio"], div#bco-extra-checkout-fields input[type="checkbox"], div#bco-extra-checkout-fields input.checkout-date-picker, input#terms input[type="checkbox"]',setBillingAddress:function(e){var o="",i="";return"object"==typeof e.billingAddress&&"zip"in e.billingAddress&&""!==e.billingAddress.zip?(o=e.billingAddress.zip,i=e.billingAddress.country,t.addressData.billingAddress=e.billingAddress):"object"==typeof e.Customer.Billing&&"zip"in e.Customer.Billing&&""!==e.Customer.Billing.zip&&(o=e.Customer.Billing.zip,i=e.Customer.Billing.country,t.addressData.billingAddress=e.Customer.Billing),{billingZip:o,billingCountry:i}},updateBillmateCheckout:function(){e(".woocommerce-checkout-review-order-table").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajax({type:"POST",url:bco_wc_params.update_checkout_url,data:{nonce:bco_wc_params.update_checkout_nonce},dataType:"json",success:function(e){},error:function(e){},complete:function(o){!0===o.responseJSON.success?(o.responseJSON.data&&o.responseJSON.data.refreshZeroAmount&&window.location.reload(),t.update(),e(".woocommerce-checkout-review-order-table").unblock()):""!==o.responseJSON.data.redirect_url&&(window.location.href=o.responseJSON.data.redirect_url)}})},getBillmateCheckout:function(){e.ajax({type:"POST",url:bco_wc_params.get_checkout_url,data:{nonce:bco_wc_params.get_checkout_nonce},dataType:"json",success:function(e){},error:function(e){return!1},complete:function(o){t.setCustomerData(o.responseJSON.data),e("form.checkout #terms").length>0&&e("form.checkout #terms").prop("checked",!0),t.submitForm()}})},setCustomerData:function(t){null!==t.billing_address&&void 0!==t.billing_address?(e("#billing_first_name").val("firstname"in t.billing_address?t.billing_address.firstname:""),e("#billing_last_name").val("lastname"in t.billing_address?t.billing_address.lastname:""),e("#billing_company").val("company"in t.billing_address?t.billing_address.company:""),e("#billing_address_1").val("street"in t.billing_address?t.billing_address.street:""),e("#billing_address_2").val("street2"in t.billing_address?t.billing_address.street2:""),e("#billing_city").val("city"in t.billing_address?t.billing_address.city:""),e("#billing_postcode").val("zip"in t.billing_address?t.billing_address.zip:""),e("#billing_phone").val("phone"in t.billing_address?t.billing_address.phone:""),e("#billing_email").val("email"in t.billing_address?t.billing_address.email:""),e("#billing_country").val("country"in t.billing_address?t.billing_address.country.toUpperCase():"")):window.location.reload(),null!==t.shipping_address?(e("#ship-to-different-address-checkbox").prop("checked",!0),e("#shipping_first_name").val("firstname"in t.shipping_address?t.shipping_address.firstname:""),e("#shipping_last_name").val("lastname"in t.shipping_address?t.shipping_address.lastname:""),e("#shipping_company").val("company"in t.shipping_address?t.billing_address.company:""),e("#shipping_address_1").val("street"in t.shipping_address?t.shipping_address.street:""),e("#shipping_address_2").val("street2"in t.shipping_address?t.shipping_address.street2:""),e("#shipping_city").val("city"in t.shipping_address?t.shipping_address.city:""),e("#shipping_postcode").val("zip"in t.shipping_address?t.shipping_address.zip:""),e("#shipping_country").val("country"in t.shipping_address?t.shipping_address.country.toUpperCase():"")):(e("#shipping_first_name").val("firstname"in t.billing_address?t.billing_address.firstname:""),e("#shipping_last_name").val("lastname"in t.billing_address?t.billing_address.lastname:""),e("#shipping_company").val("company"in t.billing_address?t.billing_address.company:""),e("#shipping_address_1").val("street"in t.billing_address?t.billing_address.street:""),e("#shipping_address_2").val("street2"in t.billing_address?t.billing_address.street2:""),e("#shipping_city").val("city"in t.billing_address?t.billing_address.city:""),e("#shipping_postcode").val("zip"in t.billing_address?t.billing_address.zip:""),e("#shipping_country").val("country"in t.billing_address?t.billing_address.country.toUpperCase():""))},documentReady:function(){t.moveExtraCheckoutFields()},changeFromBCO:function(o){o.preventDefault(),e(t.checkoutFormSelector).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajax({type:"POST",dataType:"json",data:{bco:!1,nonce:bco_wc_params.change_payment_method_nonce},url:bco_wc_params.change_payment_method_url,success:function(e){},error:function(e){},complete:function(e){window.location.href=e.responseJSON.data.redirect}})},maybeChangeToBCO:function(){"bco"===e(this).val()&&(e(t.checkoutFormSelector).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e(".woocommerce-info").remove(),e.ajax({type:"POST",data:{bco:!0,nonce:bco_wc_params.change_payment_method_nonce},dataType:"json",url:bco_wc_params.change_payment_method_url,success:function(e){},error:function(e){},complete:function(e){window.location.href=e.responseJSON.data.redirect}}))},moveExtraCheckoutFields:function(){e(".woocommerce-additional-fields").appendTo("#bco-extra-checkout-fields");var t=e('form[name="checkout"] input, form[name="checkout"] select, textarea');for(i=0;i<t.length;i++){var o=t[i].name.replace("[]","\\[\\]");-1===e.inArray(o,bco_wc_params.standard_woo_checkout_fields)&&(0<e("p#"+o+"_field").length?e("p#"+o+"_field").appendTo("#bco-extra-checkout-fields"):e('input[name="'+o+'"]').closest("p").appendTo("#bco-extra-checkout-fields"))}},checkIfSelected:function(){return t.paymentMethodEl.length>0&&(t.paymentMethod=t.paymentMethodEl.filter(":checked").val(),"bco"===t.paymentMethod)},submitForm:function(){e(".woocommerce-checkout-review-order-table").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajax({type:"POST",url:bco_wc_params.submit_order,data:e("form.checkout").serialize(),dataType:"json",success:function(o){try{if("success"!==o.result)throw"Result failed";t.logToFile("Successfully placed order. Sending bco_order_validation true to Billmate"),e("body").trigger("bco_order_validation",!0),sessionStorage.setItem("billmateRedirectUrl",o.redirect_url),e("form.checkout").removeClass("processing").unblock()}catch(e){o.messages?(t.logToFile("Checkout error | "+o.messages),t.failOrder("submission",o.messages)):(t.logToFile("Checkout error | No message"),t.failOrder("submission",'<div class="woocommerce-error">Checkout error</div>'))}},error:function(e){t.logToFile("AJAX error | "+e),t.failOrder("ajax-error",e)}})},failOrder:function(o,i){e("body").trigger("bco_order_validation",!1),e("body").trigger("updated_checkout"),e(t.checkoutFormSelector).unblock(),e(".woocommerce-checkout-review-order-table").unblock(),e(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),e("form.checkout").prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+i+"</div>"),e("form.checkout").removeClass("processing").unblock(),e("form.checkout").find(".input-text, select, input:checkbox").trigger("validate").blur(),e(document.body).trigger("checkout_error",[i]),e("html, body").animate({scrollTop:e("form.checkout").offset().top-100},1e3)},logToFile:function(t){e.ajax({url:bco_wc_params.log_to_file_url,type:"POST",dataType:"json",data:{message:t,nonce:bco_wc_params.log_to_file_nonce}})},init:function(){window.addEventListener("message",t.handleEvent),t.checkIfSelected()&&(e(document).ready(t.documentReady()),t.bodyEl.on("click",t.selectAnotherSelector,t.changeFromBCO),"checkout"===bco_wc_params.checkout_flow&&t.bodyEl.on("updated_checkout",t.updateBillmateCheckout)),t.bodyEl.on("change",'input[name="payment_method"]',t.maybeChangeToBCO),t.bodyEl.on("click",t.selectAnotherSelector,t.changeFromBCO)}};t.init()}))}]);
//# sourceMappingURL=bco-checkout.min.js.map